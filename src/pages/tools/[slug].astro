---
import Layout from "../../layouts/Layout.astro";
import slugMap from "../../data/slug-map.json";
import "@new-ui/foundations";
import SoftwareApplicationSchema from "../../components/schema/SoftwareApplicationSchema.astro";
import BreadcrumbSchema from "../../components/schema/BreadcrumbSchema.astro";
import BookmarkButton from "../../components/BookmarkButton";

export async function getStaticPaths() {
  // Use slug-map for efficient path generation (no need to load full tools.json)
  const slugMapData = await import("../../data/slug-map.json");
  const paths = Object.keys(slugMapData.default).map((slug) => ({
    params: { slug },
  }));

  return paths;
}

export const prerender = true;

const { slug } = Astro.params;

// Use slug-map to find category
const categoryList = (slugMap as Record<string, string[]>)[slug as string];
const categoryName = categoryList?.[0];

if (!categoryName) {
  throw new Error(`Tool not found: ${slug}`);
}

// Dynamically import only the needed category file
const categoryTools = await import(`../../data/tools/${categoryName}.json`);
const found = categoryTools.default.find((x: any) => x.slug === slug) || null;

if (!found) {
  throw new Error(`Tool not found: ${slug}`);
}

const tool = found;
const category = categoryName;

// helpers
function extractDomain(url: string) {
  try {
    return new URL(url).hostname.replace("www.", "");
  } catch {
    return "";
  }
}
function formatDate(dateStr: string) {
  try {
    return new Date(dateStr).toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
  } catch {
    return dateStr;
  }
}

const domain = extractDomain(tool.url || "");
const formattedDate = formatDate(tool["date-added"]);
const canonicalUrl = `https://riseofmachine.com/tools/${tool.slug}`;
// Use self-hosted favicon from public folder (eliminates third-party Google requests)
const faviconUrl = `/favicons/${slug}.png`;
const fallbackPath = category === "all" ? "/" : `/${category}`;

// Dynamically import per-tool metadata (lightweight ~0.4KB file)
let meta: any = {};
try {
  const toolMetadata = await import(`../../data/tool-metadata/${slug}.json`);
  meta = toolMetadata.default;
} catch (e) {
  // Fallback to tool data if metadata file doesn't exist
  console.warn(`No metadata file for ${slug}, using tool data`);
}

const seoTitle = meta.title || tool.title;
const seoDescription = meta.description || tool.body;
// We don't have OG images in the new simplified metadata, so falling back to favicon or site default
const seoOgImage = faviconUrl;
const seoOgType = "website";
const seoOgSiteName = "Rise of Machine";

// Social/external links from metadata
const twitterHandle = meta.twitterHandle || null;
const githubUrl = meta.githubUrl || null;

const shareText = `Check out ${tool.title} - ${tool.body}`;
const encodedShareText = encodeURIComponent(shareText);
const encodedCanonicalUrl = encodeURIComponent(canonicalUrl);
const xShareUrl = `https://x.com/intent/post?text=${encodedShareText}&url=${encodedCanonicalUrl}&via=planetabhi`;
const linkedinShareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedCanonicalUrl}`;
const redditShareUrl = `https://www.reddit.com/submit?url=${encodedCanonicalUrl}&title=${encodedShareText}`;

// Get category title for breadcrumb
// We'll use the category name directly since we don't have the full data loaded
const categoryTitle =
  categoryName.charAt(0).toUpperCase() + categoryName.slice(1);

// Get related tools from same category (up to 4)
const relatedTools = categoryTools.default
  .filter((t: any) => t.slug !== slug)
  .slice(0, 4);

// Get prev/next tools for navigation
const allCategoryTools = categoryTools.default;
const currentIndex = allCategoryTools.findIndex((t: any) => t.slug === slug);
const prevTool =
  currentIndex > 0
    ? allCategoryTools[currentIndex - 1]
    : allCategoryTools[allCategoryTools.length - 1];
const nextTool =
  currentIndex < allCategoryTools.length - 1
    ? allCategoryTools[currentIndex + 1]
    : allCategoryTools[0];

// Breadcrumb data
const breadcrumbs = [
  { name: "Home", url: "https://riseofmachine.com" },
  { name: categoryTitle, url: `https://riseofmachine.com/${category}` },
  { name: tool.title },
];
---

<Layout
  site={`Rise of Machine - ${tool.title}`}
  title={tool.title}
  tagline={tool.body}
  pageTitle={seoTitle}
  pageDescription={seoDescription}
  canonicalUrl={canonicalUrl}
  ogTitle={seoTitle}
  ogDescription={seoDescription}
  ogUrl={canonicalUrl}
  ogImage={seoOgImage}
  ogType={seoOgType}
  ogSiteName={seoOgSiteName}
  twitterCard="summary"
  twitterTitle={seoTitle}
  twitterDescription={seoDescription}
  twitterImage={seoOgImage}
  pageFavicon={faviconUrl}
>
  <SoftwareApplicationSchema
    name={tool.title}
    description={tool.body}
    url={tool.url}
    tag={tool.tag}
    dateAdded={tool["date-added"]}
    category={category}
  />
  <BreadcrumbSchema items={breadcrumbs} />
  <main>
    <div class="tool-detail-modal-backdrop" id="modalBackdrop">
      <!-- Navigation arrows (desktop only) -->
      <a
        href={`/tools/${prevTool.slug}`}
        class="nav-arrow nav-arrow--prev"
        aria-label={`Previous tool: ${prevTool.title}`}
        title={prevTool.title}
        data-nav-prev
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 48 48"
          width="32"
          height="32"
        >
          <path
            d="M44 24H5M24.5 4.5 5 24l19.5 19.5"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-miterlimit="10"></path>
        </svg>
      </a>
      <a
        href={`/tools/${nextTool.slug}`}
        class="nav-arrow nav-arrow--next"
        aria-label={`Next tool: ${nextTool.title}`}
        title={nextTool.title}
        data-nav-next
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 48 48"
          width="32"
          height="32"
        >
          <path
            d="M4 24h39M23.5 43.5 43 24 23.5 4.5"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-miterlimit="10"></path>
        </svg>
      </a>

      <div
        class="tool-detail-modal"
        id="toolModal"
        data-fallback={fallbackPath}
        data-prev-tool={`/tools/${prevTool.slug}`}
        data-next-tool={`/tools/${nextTool.slug}`}
      >
        <button
          class="tool-detail-close-btn"
          id="closeModal"
          title="Close (Press ESC)"
          aria-label="Close tool details"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
            ><path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M18 6L6 18M6 6l12 12"></path></svg
          >
        </button>

        <div class="tool-detail-header">
          <div class="tool-icon-container">
            <img
              src={faviconUrl}
              alt={`${tool.title} icon`}
              class="tool-icon"
              onerror="this.style.display='none'"
            />
          </div>
          <div class="tool-header-content">
            <h1 class="tool-title nu-c-h5 nu-u-text--primary">{tool.title}</h1>
            <div class="tool-header-meta">
              <a href={`/${category}`} class="category-badge">{categoryTitle}</a
              >
              <span class="meta-separator">·</span>
              <span class="tool-meta nu-c-text nu-u-text--secondary"
                >Added {formattedDate}</span
              >
            </div>
          </div>
        </div>

        <div class="tool-detail-content">
          <section class="tool-summary">
            <article>
              <p class="snapshot-label">About</p>
              <p class="tool-description">{tool.body}</p>
              {
                meta.description && meta.description !== tool.body && (
                  <p class="tool-description-full">{meta.description}</p>
                )
              }
            </article>

            <div class="snapshot-grid">
              <article class="snapshot-card">
                <p class="snapshot-label">Pricing</p>
                <p class="snapshot-value">{tool.tag}</p>
              </article>
              <article class="snapshot-card">
                <p class="snapshot-label">Official site</p>
                {
                  tool.url ? (
                    <a
                      href={tool.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="snapshot-value link-muted"
                    >
                      {domain || tool.url}
                    </a>
                  ) : (
                    <p class="snapshot-value snapshot-value--muted">
                      Not provided
                    </p>
                  )
                }
              </article>
            </div>

            <div class="tool-detail-actions">
              {
                tool.url ? (
                  <a
                    href={tool.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="btn-primary"
                  >
                    Visit {tool.title}
                  </a>
                ) : (
                  <span class="btn-primary btn-disabled" aria-disabled="true">
                    No website listed
                  </span>
                )
              }
            </div>
          </section>

          <div class="tool-detail-share">
            <h3 class="share-title">Share</h3>
            <div class="share-buttons">
              <a
                href={xShareUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="share-btn"
                title="Share on X"
                aria-label="Share on X"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  viewBox="0 0 256 256"
                  ><path
                    d="M214.75,211.71l-62.6-98.38,61.77-67.95a8,8,0,0,0-11.84-10.76L143.24,99.34,102.75,35.71A8,8,0,0,0,96,32H48a8,8,0,0,0-6.75,12.3l62.6,98.37-61.77,68a8,8,0,1,0,11.84,10.76l58.84-64.72,40.49,63.63A8,8,0,0,0,160,224h48a8,8,0,0,0,6.75-12.29ZM164.39,208,62.57,48h29L193.43,208Z"
                  ></path></svg
                >
              </a>
              <a
                href={linkedinShareUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="share-btn"
                title="Share on LinkedIn"
                aria-label="Share on LinkedIn"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  viewBox="0 0 256 256"
                  ><path
                    d="M216,24H40A16,16,0,0,0,24,40V216a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V40A16,16,0,0,0,216,24Zm0,192H40V40H216V216ZM96,112v64a8,8,0,0,1-16,0V112a8,8,0,0,1,16,0Zm88,28v36a8,8,0,0,1-16,0V140a20,20,0,0,0-40,0v36a8,8,0,0,1-16,0V112a8,8,0,0,1,15.79-1.78A36,36,0,0,1,184,140ZM100,84A12,12,0,1,1,88,72,12,12,0,0,1,100,84Z"
                  ></path></svg
                >
              </a>
              <a
                href={redditShareUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="share-btn"
                title="Share on Reddit"
                aria-label="Share on Reddit"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  viewBox="0 0 256 256"
                  ><path
                    d="M248,104a32,32,0,0,0-52.94-24.19c-16.75-8.9-36.76-14.28-57.66-15.53l5.19-31.17,17.72,2.72a24,24,0,1,0,2.87-15.74l-26-4a8,8,0,0,0-9.11,6.59L121.2,64.16c-21.84.94-42.82,6.38-60.26,15.65a32,32,0,0,0-42.59,47.74A59,59,0,0,0,16,144c0,21.93,12,42.35,33.91,57.49C70.88,216,98.61,224,128,224s57.12-8,78.09-22.51C228,186.35,240,165.93,240,144a59,59,0,0,0-2.35-16.45A32.16,32.16,0,0,0,248,104ZM184,24a8,8,0,1,1-8,8A8,8,0,0,1,184,24Zm40.13,93.78a8,8,0,0,0-3.29,10A43.58,43.58,0,0,1,224,144c0,16.53-9.59,32.27-27,44.33C178.67,201,154.17,208,128,208s-50.67-7-69-19.67C41.59,176.27,32,160.53,32,144a43.75,43.75,0,0,1,3.14-16.17,8,8,0,0,0-3.27-10A16,16,0,1,1,52.94,94.59a8,8,0,0,0,10.45,2.23l.36-.22C81.45,85.9,104.25,80,128,80h0c23.73,0,46.53,5.9,64.23,16.6l.42.25a8,8,0,0,0,10.39-2.26,16,16,0,1,1,21.07,23.19ZM88,144a16,16,0,1,1,16-16A16,16,0,0,1,88,144Zm96-16a16,16,0,1,1-16-16A16,16,0,0,1,184,128Zm-16.93,44.25a8,8,0,0,1-3.32,10.82,76.18,76.18,0,0,1-71.5,0,8,8,0,1,1,7.5-14.14,60.18,60.18,0,0,0,56.5,0A8,8,0,0,1,167.07,172.25Z"
                  ></path></svg
                >
              </a>
              <button
                class="share-btn"
                id="copyLinkBtn"
                title="Copy link to clipboard"
                aria-label="Copy link to clipboard"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  viewBox="0 0 256 256"
                  ><path
                    d="M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,16,.45A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"
                  ></path></svg
                >
              </button>
            </div>
          </div>

          {
            (twitterHandle || githubUrl) && (
              <div class="tool-external-links">
                <h3 class="external-links-title">Links</h3>
                <div class="external-links-buttons">
                  {twitterHandle && (
                    <a
                      href={`https://x.com/${twitterHandle.replace("@", "")}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="external-link-btn"
                      title={`Follow on X ${twitterHandle}`}
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        fill="currentColor"
                        viewBox="0 0 256 256"
                      >
                        <path d="M214.75,211.71l-62.6-98.38,61.77-67.95a8,8,0,0,0-11.84-10.76L143.24,99.34,102.75,35.71A8,8,0,0,0,96,32H48a8,8,0,0,0-6.75,12.3l62.6,98.37-61.77,68a8,8,0,1,0,11.84,10.76l58.84-64.72,40.49,63.63A8,8,0,0,0,160,224h48a8,8,0,0,0,6.75-12.29ZM164.39,208,62.57,48h29L193.43,208Z" />
                      </svg>
                      <span>{twitterHandle}</span>
                    </a>
                  )}
                  {githubUrl && (
                    <a
                      href={githubUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="external-link-btn"
                      title="View on GitHub"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        fill="currentColor"
                        viewBox="0 0 256 256"
                      >
                        <path d="M208.31,75.68A59.78,59.78,0,0,0,202.93,28,8,8,0,0,0,196,24a59.75,59.75,0,0,0-48,24H124A59.75,59.75,0,0,0,76,24a8,8,0,0,0-6.93,4,59.78,59.78,0,0,0-5.38,47.68A58.14,58.14,0,0,0,56,104v8a56.06,56.06,0,0,0,48.44,55.47A39.8,39.8,0,0,0,96,192v8H72a24,24,0,0,1-24-24A40,40,0,0,0,8,136a8,8,0,0,0,0,16,24,24,0,0,1,24,24,40,40,0,0,0,40,40H96v16a8,8,0,0,0,16,0V192a24,24,0,0,1,48,0v40a8,8,0,0,0,16,0V192a39.8,39.8,0,0,0-8.44-24.53A56.06,56.06,0,0,0,216,112v-8A58.14,58.14,0,0,0,208.31,75.68ZM200,112a40,40,0,0,1-40,40H112a40,40,0,0,1-40-40v-8a41.74,41.74,0,0,1,6.9-22.48A8,8,0,0,0,80,73.55a43.81,43.81,0,0,1,.79-33.58,43.88,43.88,0,0,1,32.32,20.06A8,8,0,0,0,119.82,64h32.35a8,8,0,0,0,6.74-3.69,43.87,43.87,0,0,1,32.32-20.06A43.81,43.81,0,0,1,192,73.55a8,8,0,0,0,1.11,7.92A41.74,41.74,0,0,1,200,104Z" />
                      </svg>
                      <span>GitHub</span>
                    </a>
                  )}
                </div>
              </div>
            )
          }

          {
            relatedTools.length > 0 && (
              <div class="tool-related">
                <h3 class="related-title">Similar Tools</h3>
                <div class="related-grid">
                  {relatedTools.map((t: any) => (
                    <a href={`/tools/${t.slug}`} class="related-card">
                      <img
                        src={`/favicons/${t.slug}.png`}
                        alt=""
                        class="related-icon"
                        onerror="this.style.display='none'"
                      />
                      <span class="related-name">{t.title}</span>
                    </a>
                  ))}
                </div>
              </div>
            )
          }

          <div class="tool-detail-nav">
            <a href={category === "all" ? "/" : `/${category}`} class="nav-link"
              >← Go back</a
            >
            <BookmarkButton
              client:load
              slug={slug}
              title={tool.title}
              variant="default"
            />
          </div>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    function initToolModal() {
      const modalEl = document.getElementById("toolModal");
      if (!modalEl) return;

      const fallbackNavigateTo = modalEl.dataset.fallback || "/";
      const hasSameOriginReferrer = (() => {
        try {
          if (!document.referrer) return false;
          const ref = new URL(document.referrer);
          return ref.origin === window.location.origin;
        } catch {
          return false;
        }
      })();

      function closeModal() {
        document.body.removeAttribute("data-modal-open");
        document.body.style.overflow = "";
        if (hasSameOriginReferrer && window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = fallbackNavigateTo;
        }
      }

      function handleClick(e) {
        const close = e.target.closest(".tool-detail-close-btn");
        if (close) {
          e.preventDefault();
          e.stopPropagation();
          return closeModal();
        }

        // If clicked outside the modal but inside backdrop (exclude nav arrows)
        const backdrop = e.target.closest(".tool-detail-modal-backdrop");
        const modal = e.target.closest(".tool-detail-modal");
        const navArrow = e.target.closest(".nav-arrow");
        if (backdrop && !modal && !navArrow) {
          e.preventDefault();
          return closeModal();
        }

        const copyBtn = e.target.closest("#copyLinkBtn");
        if (copyBtn) {
          const url = window.location.href;
          navigator.clipboard.writeText(url).then(() => {
            const original = copyBtn.innerHTML;
            copyBtn.innerHTML =
              '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            copyBtn.title = "Copied!";
            setTimeout(() => {
              copyBtn.innerHTML = original;
              copyBtn.title = "Copy link to clipboard";
            }, 2000);
          });
        }
      }

      function handleKeydown(e) {
        // Get fresh reference to modal for navigation data
        const currentModal = document.getElementById("toolModal");

        if (e.key === "Escape") closeModal();

        if (e.key === "ArrowLeft") {
          const prevUrl = currentModal?.dataset.prevTool;
          if (prevUrl) window.location.href = prevUrl;
        }
        if (e.key === "ArrowRight") {
          const nextUrl = currentModal?.dataset.nextTool;
          if (nextUrl) window.location.href = nextUrl;
        }
      }

      // Remove any existing listeners before adding new ones
      document.removeEventListener("click", handleClick);
      document.removeEventListener("keydown", handleKeydown);

      document.addEventListener("click", handleClick);
      document.addEventListener("keydown", handleKeydown);

      // Mark that modal is open
      document.body.setAttribute("data-modal-open", "true");
      document.body.style.overflow = "hidden";
    }

    // Initialize on first load
    initToolModal();

    // Re-initialize on ViewTransitions navigation
    document.addEventListener("astro:page-load", initToolModal);

    // Cleanup on page hide
    window.addEventListener("pagehide", () => {
      document.body.removeAttribute("data-modal-open");
      document.body.style.overflow = "";
    });
  </script>

  <style is:global>
    /* Hide hero immediately on tool pages to prevent flash */
    html[data-tool-page="true"] .hero,
    html[data-tool-page="true"] .footer {
      display: none !important;
    }

    /* Hide all background content when modal is open, except floating nav */
    body[data-modal-open="true"] .hero,
    body[data-modal-open="true"] main > *:not(.tool-detail-modal-backdrop),
    body[data-modal-open="true"] .footer {
      display: none !important;
    }

    section {
      margin-bottom: var(--spacing-04);
    }
  </style>

  <style scoped>
    article {
      margin-bottom: var(--spacing-06);
    }
    .tool-detail-modal-backdrop {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000000;
      padding: var(--spacing-05);
      overflow-y: auto;
      background-image: url(/grid.png);
      background-size: 5px;
      background-repeat: repeat;
      /* background-color: rgba(0, 0, 0, 0.32); */
    }

    /* Navigation arrows */
    .nav-arrow {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10000001;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
      color: var(--content-secondary);
      text-decoration: none;
      opacity: 0.7;
      transition:
        opacity 0.2s ease,
        background-color 0.2s ease;
    }

    .nav-arrow:hover {
      opacity: 1;
      background-color: var(--background-secondary);
      color: var(--content-primary);
    }

    .nav-arrow--prev {
      left: var(--spacing-06);
    }

    .nav-arrow--next {
      right: var(--spacing-06);
    }

    /* Hide nav arrows on mobile */
    @media (max-width: 900px) {
      .nav-arrow {
        display: none;
      }
    }

    .tool-detail-modal {
      background-color: var(--background-secondary);
      width: 100%;
      max-width: 680px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      padding: var(--spacing-09);
      background-color: var(--background);
      content-visibility: auto;
      contain-intrinsic-size: 8.5rem;
      transition: box-shadow 0.2s ease-out;
    }

    .tool-detail-close-btn {
      position: absolute;
      top: var(--spacing-06);
      right: var(--spacing-06);
      background: none;
      border: none;
      cursor: pointer;
      color: var(--content-secondary);
      width: var(--spacing-09);
      height: var(--spacing-09);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tool-detail-close-btn:hover {
      background-color: var(--background-secondary);
      color: var(--content-primary);
    }

    .tool-detail-header {
      display: flex;
      gap: var(--spacing-06);
      align-items: flex-start;
      margin-bottom: var(--spacing-06);
    }

    .tool-icon {
      width: 48px;
      height: 48px;
    }

    .tool-detail-title {
      margin: 0;
      font-size: var(--desktop-heading-06);
      line-height: var(--lh-desktop-heading-06);
      font-weight: 600;
      color: var(--content-primary);
    }

    .tool-meta {
      margin: 0;
      color: var(--content-secondary-alt);
      font-size: var(--desktop-body-sm);
      line-height: var(--lh-desktop-body-sm);
    }

    .tool-detail-content {
      display: flex;
      flex-direction: column;
    }

    .tool-summary {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-05);
    }

    .tool-description {
      margin: 0;
      color: var(--content-primary);
      font-size: var(--desktop-body);
      line-height: var(--lh-desktop-body);
    }

    .tool-description-full {
      margin: var(--spacing-04) 0 0 0;
      color: var(--content-secondary);
      font-size: var(--desktop-body-sm);
      line-height: var(--lh-desktop-body);
    }

    .summary-meta {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-01);
    }

    .summary-label {
      font-size: var(--desktop-caption);
      color: var(--content-secondary-alt);
      text-transform: uppercase;
    }

    .summary-value {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    .summary-value:hover {
      text-decoration: underline;
    }

    .summary-value--muted {
      color: var(--content-secondary);
      text-decoration: none;
    }

    .tool-section {
      display: flex;
      flex-direction: column;
      background: var(--background-secondary);
      gap: var(--spacing-05);
      padding: var(--spacing-06);

      border: 0.5px solid var(--border-muted);
    }

    .section-header {
      display: flex;
      gap: var(--spacing-05);
      align-items: flex-start;
    }

    .section-eyebrow {
      margin: 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary-alt);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .section-title {
      margin: 0;
      font-size: var(--desktop-h5);
      color: var(--content-primary);
    }

    .section-subtitle {
      margin: var(--spacing-01) 0 0 0;
      color: var(--content-secondary);
    }

    .snapshot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--spacing-04);
    }

    .snapshot-card {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-01);
    }

    .snapshot-label {
      margin: 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary);
      font-family: var(--monospace);
      letter-spacing: 0.05rem;
      text-transform: uppercase;
    }

    .snapshot-value {
      margin: 0;
      color: var(--content-primary);
      font-size: var(--desktop-body-sm);
      line-height: var(--lh-desktop-body-sm);
    }

    .snapshot-value--muted {
      color: var(--content-primary);
    }

    .category-link {
      color: var(--accent);
      text-decoration: none;
    }

    .category-link:hover {
      text-decoration: underline;
    }

    .link-muted {
      text-decoration: none;
    }

    .link-muted:hover {
      color: var(--accent);
    }

    .tool-detail-actions {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-02);
    }

    .btn-primary {
      display: inline-block;
      padding: var(--spacing-03) var(--spacing-05);
      background-color: var(--accent);
      color: var(--background-high-contrast);
      text-decoration: none;
      font-weight: 600;
      text-align: center;
      font-size: var(--desktop-body);
      line-height: var(--lh-desktop-body);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .btn-disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .action-hint {
      margin: 0;
      color: var(--content-secondary);
      font-size: var(--desktop-caption);
    }

    .live-metadata-grid {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-05);
    }

    .live-group {
    }

    .live-group-label {
      margin: 0 0 var(--spacing-03) 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary-alt);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .live-card-grid {
      display: grid;
      gap: var(--spacing-06);
    }

    .live-card {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-03);
    }

    .live-card-inline .favicon-preview {
      display: flex;
      align-items: center;
      gap: var(--spacing-03);
    }

    .live-card-image img {
      width: 100%;

      border: 1px solid var(--border-muted);
      object-fit: cover;
    }

    .live-label {
      margin: 0;
      font-size: var(--desktop-caption);
      text-transform: uppercase;
      color: var(--content-secondary-alt);
    }

    .live-value {
      margin: 0;
      color: var(--content-primary);
      font-size: var(--desktop-body-sm);
      line-height: var(--lh-desktop-body-sm);
    }

    .live-link {
      color: var(--accent);
      word-break: break-all;
      text-decoration: none;
    }

    .live-link:hover {
      text-decoration: underline;
    }

    .favicon-preview img {
      border: 1px solid var(--border-muted);
    }

    .list-pills {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-02);
    }

    .list-pills li {
      background-color: var(--background-secondary);
      padding: 0;

      font-size: var(--desktop-caption);
      color: var(--content-secondary);
    }

    .share-buttons {
      display: flex;
      gap: var(--spacing-03);
    }

    .share-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;

      background-color: var(--background);
      border: none;
      color: var(--content-secondary);
    }

    .share-btn:hover {
      color: var(--accent);
      background-color: var(--background-secondary);
    }

    .tool-detail-nav {
      margin-top: var(--spacing-06);
      padding-top: var(--spacing-05);
      border-top: 0.5px solid var(--border-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-03);
    }

    .nav-link {
      color: var(--content-secondary);
      text-decoration: none;
    }

    .share-title {
      margin: 0 0 var(--spacing-04) 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary);
      font-family: var(--monospace);
      letter-spacing: 0.05rem;
      text-transform: uppercase;
    }

    .tool-detail-share {
      margin-top: var(--spacing-06);
    }

    /* Category badge */
    .tool-header-meta {
      display: flex;
      align-items: center;
      gap: var(--spacing-02);
      flex-wrap: wrap;
    }

    .category-badge {
      display: inline-block;
      padding: var(--spacing-01) var(--spacing-03);
      background-color: var(--background-selected);
      color: var(--content-secondary);
      font-size: var(--desktop-caption);
      line-height: var(--lh-desktop-caption);
      text-decoration: none;
      border-radius: var(--spacing-00);
    }

    .category-badge:hover {
      background-color: var(--accent);
      color: var(--background);
    }

    .meta-separator {
      color: var(--content-secondary);
    }

    /* External links section */
    .tool-external-links {
      margin-top: var(--spacing-06);
      padding-top: var(--spacing-05);
      border-top: 0.5px solid var(--border-muted);
    }

    .external-links-title {
      margin: 0 0 var(--spacing-04) 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary);
      font-family: var(--monospace);
      letter-spacing: 0.05rem;
      text-transform: uppercase;
    }

    .external-links-buttons {
      display: flex;
      gap: var(--spacing-03);
      flex-wrap: wrap;
    }

    .external-link-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-02);
      padding: var(--spacing-02) var(--spacing-04);
      background-color: var(--background-secondary);
      color: var(--content-primary);
      text-decoration: none;
      font-size: var(--desktop-body-sm);
      border-radius: var(--spacing-00);
    }

    .external-link-btn:hover {
      background-color: var(--background-selected);
    }

    /* Related tools section */
    .tool-related {
      margin-top: var(--spacing-06);
      padding-top: var(--spacing-05);
      border-top: 0.5px solid var(--border-muted);
    }

    .related-title {
      margin: 0 0 var(--spacing-04) 0;
      font-size: var(--desktop-caption);
      color: var(--content-secondary);
      font-family: var(--monospace);
      letter-spacing: 0.05rem;
      text-transform: uppercase;
    }

    .related-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-03);
    }

    .related-card {
      display: flex;
      align-items: center;
      gap: var(--spacing-03);
      padding: var(--spacing-03);
      background-color: var(--background-secondary);
      text-decoration: none;
      border-radius: var(--spacing-00);
    }

    .related-card:hover {
      background-color: var(--background-selected);
    }

    .related-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .related-name {
      color: var(--content-primary);
      font-size: var(--desktop-body-sm);
      line-height: var(--lh-desktop-body-sm);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    span.tag {
      background-color: var(--background-selected);
      padding: calc(0.25rem - 1px) calc(0.5rem - 1px);
      display: inline-block;
      color: var(--content-secondary);
      font-size: var(--desktop-caption);
      line-height: var(--lh-desktop-caption);
      font-family: var(--body-copy);
    }

    @media (max-width: 768px) {
      .tool-detail-modal {
        padding: var(--spacing-06);
        margin: var(--spacing-05);
      }

      .tool-icon {
        width: 48px;
        height: 48px;
      }

      .section-header {
        flex-direction: column;
      }

      .tool-section {
        padding: var(--spacing-05);
      }

      .related-grid {
        grid-template-columns: 1fr;
      }

      .external-links-buttons {
        flex-direction: column;
      }
    }
  </style>
</Layout>
