---
interface Props {
    name: string;
    description: string;
    url: string;
    tag?: string;
    dateAdded?: string;
    category?: string;
}

const { name, description, url, tag, dateAdded, category } = Astro.props;

// Map tool categories to Schema.org ApplicationCategory values
const getCategoryMapping = (toolCategory?: string): string => {
    const categoryMap: Record<string, string> = {
        // Creative & Media
        art: "DesignApplication",
        design: "DesignApplication",
        photos: "DesignApplication",
        audio: "MultimediaApplication",
        music: "MultimediaApplication",
        video: "MultimediaApplication",

        // Development & Technical
        code: "DeveloperApplication",
        developer: "DeveloperApplication",
        nocode: "DeveloperApplication",

        // Business & Productivity
        productivity: "BusinessApplication",
        enterprise: "BusinessApplication",
        legal: "BusinessApplication",

        // Content & Marketing
        copywriting: "BusinessApplication",
        seo: "BusinessApplication",
        social: "CommunicationApplication",

        // Education & Research
        education: "EducationalApplication",
        research: "EducationalApplication",

        // AI & Advanced
        llm: "DeveloperApplication",
        prompts: "DeveloperApplication",

        // Entertainment
        gaming: "GameApplication",
        fashion: "LifestyleApplication",

        // Health & Wellness
        health: "HealthApplication",

        // Miscellaneous
        xtras: "BusinessApplication",
    };

    if (!toolCategory) return "BusinessApplication";

    return categoryMap[toolCategory.toLowerCase()] || "BusinessApplication";
};

// Parse pricing from tag
const getPricing = (tag?: string) => {
    if (!tag) return { price: "0", priceCurrency: "USD" };

    if (tag === "Free" || tag === "Freemium") {
        return { price: "0", priceCurrency: "USD" };
    }

    // Extract price from tags like "From $9/mo" or "$12/mo"
    const priceMatch = tag.match(/\$(\d+\.?\d*)/);
    if (priceMatch) {
        return { price: priceMatch[1], priceCurrency: "USD" };
    }

    return { price: "0", priceCurrency: "USD" };
};

const pricing = getPricing(tag);
const applicationCategory = getCategoryMapping(category);

const schema: any = {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    name: name,
    url: url,
    description: description,
    applicationCategory: applicationCategory,
    operatingSystem: "Web",
    offers: {
        "@type": "Offer",
        price: pricing.price,
        priceCurrency: pricing.priceCurrency,
    },
};

// Add datePublished if available
if (dateAdded) {
    schema.datePublished = dateAdded;
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
